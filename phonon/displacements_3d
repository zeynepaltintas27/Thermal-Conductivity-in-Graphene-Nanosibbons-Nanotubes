# ---------- Displace Atoms and Calculate Forces ---------------------
# Loop through displacements
variable displace_step equal 0.01  # Displacement magnitude
label loop
variable i loop 3  # Loop for x, y, z directions

    # Set displacements in each direction based on the loop index
    if "${i} == 1" then "variable dx equal ${displace_step}" &
                      "variable dy equal 0.0" &
                      "variable dz equal 0.0"
    if "${i} == 2" then "variable dx equal 0.0" &
                      "variable dy equal ${displace_step}" &
                      "variable dz equal 0.0"
    if "${i} == 3" then "variable dx equal 0.0" &
                      "variable dy equal 0.0" &
                      "variable dz equal ${displace_step}"

    # Displace atoms along x, y, or z based on loop index
    displace_atoms all move ${dx} ${dy} ${dz}

    # Output forces after each displacement for phonon calculations
    # dump 1 all custom 100 graphene_output.lammpstrj id type x y z
    dump dump_force all custom 1 graphene_forces_${i}.lammpstrj id type x y z fx fy fz


    run 0  # Only compute forces without moving atoms

    
    undump dump_force  # Clear previous dump to prepare for next loop

next i
jump SELF loop  # Return to loop